<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Metadata Test</title>
    <style>
        body {
            font-family: monospace;
            background: #111;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .success { border-color: #4ade80; }
        .error { border-color: #f87171; }
        .nft-preview {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #333;
        }
        .nft-image {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }
        .traits {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        .trait {
            background: #333;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .trait-type {
            color: #999;
            display: block;
            font-size: 10px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <h1>üß™ Local Metadata Service Test</h1>
    <div id="results"></div>

    <script>
        // Simplified local metadata fetch function for testing
        async function fetchLocalMetadata(tokenId) {
            try {
                const response = await fetch(`/metadata/${tokenId}.json`);
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error(`Error fetching local metadata for token ${tokenId}:`, error);
                return null;
            }
        }

        // Test function
        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-result">üîÑ Running tests...</div>';

            // Test 1: Individual fetch
            try {
                const metadata = await fetchLocalMetadata(304);
                if (metadata) {
                    results.innerHTML += `
                        <div class="test-result success">
                            ‚úÖ Test 1 PASSED: Individual fetch for #304
                            <div class="nft-preview">
                                <h3>${metadata.name}</h3>
                                <img src="${metadata.image}" alt="${metadata.name}" class="nft-image">
                                <p>${metadata.description.substring(0, 100)}...</p>
                                <div class="traits">
                                    ${metadata.attributes.slice(0, 4).map(trait => `
                                        <div class="trait">
                                            <span class="trait-type">${trait.trait_type}</span>
                                            ${trait.value}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    results.innerHTML += '<div class="test-result error">‚ùå Test 1 FAILED: Could not fetch #304</div>';
                }
            } catch (error) {
                results.innerHTML += `<div class="test-result error">‚ùå Test 1 ERROR: ${error.message}</div>`;
            }

            // Test 2: Multiple tokens
            const testTokens = [1, 2, 100, 101];
            let successCount = 0;
            
            for (const tokenId of testTokens) {
                try {
                    const metadata = await fetchLocalMetadata(tokenId);
                    if (metadata) {
                        successCount++;
                        results.innerHTML += `
                            <div class="test-result success">
                                ‚úÖ Token #${tokenId}: ${metadata.name} (${metadata.attributes.length} traits)
                            </div>
                        `;
                    } else {
                        results.innerHTML += `
                            <div class="test-result error">
                                ‚ùå Token #${tokenId}: Not found
                            </div>
                        `;
                    }
                } catch (error) {
                    results.innerHTML += `
                        <div class="test-result error">
                            ‚ùå Token #${tokenId}: Error - ${error.message}
                        </div>
                    `;
                }
            }

            // Test 3: Non-existent token
            try {
                const metadata = await fetchLocalMetadata(99999);
                if (!metadata) {
                    results.innerHTML += `
                        <div class="test-result success">
                            ‚úÖ Test 3 PASSED: Non-existent token #99999 correctly returns null
                        </div>
                    `;
                } else {
                    results.innerHTML += `
                        <div class="test-result error">
                            ‚ùå Test 3 FAILED: Non-existent token should return null
                        </div>
                    `;
                }
            } catch (error) {
                results.innerHTML += `
                    <div class="test-result error">
                        ‚ùå Test 3 ERROR: ${error.message}
                    </div>
                `;
            }

            // Summary
            results.innerHTML += `
                <div class="test-result">
                    üìä SUMMARY: ${successCount}/${testTokens.length} tokens found locally
                    <br>üéØ Local metadata service is working correctly!
                </div>
            `;
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>
